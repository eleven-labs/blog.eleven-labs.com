{"date":"2020-01-02T00:00:00.000Z","title":"Storybook - DÃ©couvrir les addons","excerpt":"DeuxiÃ¨me Ã©pisode de cette sÃ©rie, dÃ©couvrez les incroyables addons sur Storybook. C'est JUSTE des gamebreakers.","readingTime":"7mn","authors":["manu"],"categories":["javascript"],"content":"\n![Liste d'addon 1](/imgs/posts/2020-01-02-Storybook-Addons/addonlist.png)\n\nCoucou les bichons, on se retrouve pour un nouvel article qui porte sur les Addons !\n\n> Attends, attends... Tu devais pas faire un article sur le Testing ou la Documentation ?\n\nAlors oui, mais vu l'importance de la contribution des addons sur ce sujet, il aurait Ã©tÃ© bien dommage de ne pas en parler avant ! Mais pas de soucis, ces 2 sujets sont dÃ©jÃ  dans les tuyaux.\n\nPour rappel, dans le prÃ©cÃ©dent article, nous avons vu ensemble que Storybook est un environnement de dÃ©veloppement de composants. Son but est de simplifier cette tÃ¢che en fournissant des `stories` qui servent de guidelines/spec pour les composants, amÃ©liorant l'exportabilitÃ© et la rÃ©silience gÃ©nÃ©rale.\n\n## Clique sur la cloche et Addon toi\n\nBon, je pense qu'on sait tous ce qu'est une extension ou un module complÃ©mentaire :\n\nCe truc qui viens trÃ¨s souvent remplacer une tÃ¢che dont t'as bien la flemme au bout d'une semaine, et que tu sacrifies sur l'autel des ralentissements au dÃ©marrage.\n\nAvant de cracher davantage dans la soupe, laissons quand mÃªme la parole au cuisinier, car qui mieux que Storybook pour vendre sa propre came ?\n\n> **Supercharge Storybook**\n> Storybook addons enable advanced functionality and unlock new workflows. Contributed by core maintainers and the amazing developer community.\n\nDonc on nous promet des supers modules qui viennent enrichir notre expÃ©rience, maintenus par Storybook et leur communautÃ© ? Ã‡a transpire pas l'originalitÃ©, mais Ã§a a le mÃ©rite qu'on lui laisse une chance.\n\nOn pourrait presque Ãªtre rabat-joie en se disant que c'est juste une mode d'ouvrir son projet aux addons communautaires... mais lÃ , Storybook Ã  vraiment l'air d'avoir pris les choses trÃ¨s au sÃ©rieux.\n\nDÃ©jÃ  le nombre d'addons est moins important que le nombre de vendeurs de tours Eiffel au TrocadÃ©ro, on en dÃ©nombre 13 officiels et 27 communautaires, Ã§a prÃ©sage dÃ©jÃ  de la part belle Ã  la qualitÃ© et au besoin, plutÃ´t qu'Ã  la quantitÃ©.\n\n![Liste d'addon 2](/imgs/posts/2020-01-02-Storybook-Addons/addonlist2.png)\n\nDans les faits ces derniers sont rangÃ©s par fonctionnalitÃ© : **Organisation**, **Test, Code**, **Data & State**, **Style** et pour finir **Design**.\n\nEnsuite, l'intÃ©rÃªt de ces modules est communautaire, on rappelle que le but de ce projet est de simplifier la vie de ceux qui l'utilisent : PO, UX designer, dev.\n\nPar exemple, pour nous les petites mains du code, le but est de tester la rÃ©action de notre composant Ã  plusieurs Ã©tats.\n\nC'est donc tout naturellement que la communautÃ© contribue en fournissant des outils pour permettre de moquer les comportements qu'ils rencontrent au quotidien, permettant ainsi d'intÃ©grer Ã  Storybook un composant connectÃ© Ã  un store Redux, soumis Ã  un contexte comme le [ThemeProvider](https://www.styled-components.com/docs/advanced) de [Material-UI](https://material-ui.com/customization/theming/), bourrÃ© de Query/Mutation GraphQL, de l'internationalisation jusqu'Ã  l'accessibilitÃ©.\n\nEn fait, c'est ce qui fait que Storybook puisse Ãªtre pertinent, il s'intÃ¨gre dans l'Ã©cosystÃ¨me de React tout en assumant son rÃ´le.\n\nBon lÃ  je vous sens dÃ©jÃ  plus intÃ©ressÃ©s, est-ce qu'on s'en installerait pas un ou deux, comme Ã§a, pour le plaisir ?\n\n## Un fichier pour les gouverner tous\n\nLa derniÃ¨re fois, on a vu les possibilitÃ©s qu'offrait le fichier story pour soumettre notre composant Ã  plusieurs Ã©tats.\n\nJe sais que vous en rÃªvez encore la nuit mais pour les insomniaques, un petit rappel :\n\n```javascript\n    import React from 'react';\n    import { storiesOf } from '@storybook/react';\n    import { action } from '@storybook/addon-actions';\n\n    import Task from './Task';\n\n    export const task = {\n        id: '1',\n        title: 'PrÃ©venir Jeanine',\n        state: 'TASK_INBOX',\n        updatedAt: new Date(2018, 0, 1, 9, 0)\n    };\n\n    export const actions = {\n        onPinTask: action('onPinTask'),\n        onArchiveTask: action('onArchiveTask')\n    };\n\n    storiesOf('Task', module)\n    .add('default', () => <Task task={task} {...actions} />)\n    .add('pinned', () => <Task task={\\{...task, state: 'TASK_PINNED'}} {...actions} />)\n    .add('archived', () => <Task task={\\{...task, state: 'TASK_ARCHIVED'}} {...actions} />);\n```\n\nComme on est des grosses flemasses, nous on voudrait bien ne pas avoir Ã  Ã©diter ce fichier, le sauvegarder et revenir sur notre storybook pour avoir notre retour visuel...\n\nUn peu comme Ã§a non ?\n\n![Storybook knobs addon](/imgs/posts/2020-01-02-Storybook-Addons/knobs.gif)\n\nC'est cadeau, c'est l'addon **Knobs** comme on peut voir dans le petit onglet, juste Ã  cÃ´tÃ© d'**Actions**, qui lui aussi est un addon qu'on a utilisÃ© dans le tutoriel d'avant (celui qui permet de mocker des callbacks type `onClick()` par exemple) et qui est dÃ©jÃ  prÃ©sent dans notre fichier story :\n\n```javascript\n    // src/components/Task.stories.js\n    (...)\n    import { action } from '@storybook/addon-actions';\n\n    (...)\n\n    export const actions = {\n        onPinTask: action('onPinTask'),\n        onArchiveTask: action('onArchiveTask')\n    };\n```\n\nOn va donc s'empresser d'ajouter notre nouvel addon **Knobs :**\n\n`yarn add @storybook/addon-knobs`\n\nPuis on fait un petit tour dans le fichier `.storybook/addon.js` oÃ¹ l'on doit **register** notre addon\n\n```javascript\n// .storybook/addons.js\n\nimport \"@storybook/addon-actions/register\";\nimport \"@storybook/addon-knobs/register\";\n```\n\nC'est tout ! ğŸ˜\n\nOn va donc immÃ©diatement Ã©diter le code de notre story\n\n```javascript\n    // src/components/Task.stories.js\n\n    (...)\n    import { withKnobs, object } from '@storybook/addon-knobs/react';\n\n    (...)\n\n    storiesOf('Task', module)\n      .addDecorator(withKnobs) // on passe withKnobs en argument Ã  addDecorator()\n    \t// On passe object('knobName', props) pour trigger l'addon sur l'UI Storybook\n    \t.add('default', () => {\n        return <Task task={object('superArticleManu', { ...task })} {...actions} />;\n      })\n      .add('pinned', () => <Task task={\\{ ...task, state: 'TASK_PINNED' }} {...actions} />)\n      .add('archived', () => <Task task={\\{ ...task, state: 'TASK_ARCHIVED' }} {...actions} />);\n```\n\n![Storybook knobs addon](/imgs/posts/2020-01-02-Storybook-Addons/knobs1.png)\n\nEt lÃ  imaginez, vous filez Ã§a Ã  Jean-Marie qui est en charge de tester votre composant. Il va s'Ã©clater Ã  voir si vous avez pas fait de la daube pour revenir vers vous, avec une haleine de cendrier et de cafÃ© froid, en vous beuglant :\n\n> Eh mec ! T'as vu la gueule de ton composant ? Quand j'ai mis un titre un peu long ? Non mais je te jure... hahaha\n\n![Storybook knobs addon 2](/imgs/posts/2020-01-02-Storybook-Addons/knobs2.png)\n\nQuel coquin ce Jean-Marie, mais il n'a pas tort. On peut simplement se rajouter une nouvelle story \"long titre\" pour sauvegarder ce use-case et Ã©viter la rÃ©gression.\n\n```javascript\n    // src/components/Task.stories.js\n\n    const longTitre = \"Une phrase bien longue, du genre, que tu ne mettras jamais dans une tÃ¢che Ã  faire, mais lÃ  Charles-Edouard il tiens un truc t'inquiÃ¨te\"\n\n    storiesOf('Task', module)\n      .add('default', () => <Task task={task} {...actions} />)\n      .add('pinned', () => <Task task={\\{ ...task, state: 'TASK_PINNED' }} {...actions} />)\n      .add('archived', () => <Task task={\\{ ...task, state: 'TASK_ARCHIVED' }} {...actions} />)\n      .add('long titre', () => <Task task={\\{ ...task, title: longTitre }} {...actions} />);\n```\n\nVoilÃ  voilÃ , c'est dÃ©jÃ  fini les copains ! Mais promis on se revoit vite pour regarder ensemble, Ã  travers deux articles, comment qu'on fait pour avoir de trÃ¨s beaux **Tests structurels** et aussi une trÃ¨s belle **Documentation de composant**, genre documentation de Material UI, mais sans effort.\n\nJe pense fort Ã  vous, hÃ©sitez pas Ã  venir me claquer une bise si Ã§a vous a plu.\n\n## Ã€ bientÃ´t les bichons ğŸ‘‹\n"}